<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html><head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta title="UE INF304 - TP6">
<style>
emph {
  font-weight: bold;
}

#content {
  margin: 0% auto;
  width: 80ex;
  max-width: 80%;
  align: center;
}

p, ul, ol, li {
  text-align: justify;
}

h1,h2 {
text-align: center;
}

h5:before {
  content: "\25B6\00A0" ;
}

.important {
   color: #FF0000;
}

.nom { font-family: sans-serif; font-weight:bold; }

.code { font-family: monospace; }

.file { font-family: monospace; }

.commande { font-family: monospace; }

.algo { 
font-family: sans-serif; 
border: solid 1px #DDD;
background-color: #F9F9F9;
padding: 1ex;
margin:5%;
}

pre.code {
border: solid 1px #DDD;
background-color: #F9F9F9;
padding: 1ex;
margin:5%;
}

.text { font-style: oblique; }
.comment { font-style: oblique; }

.kw { font-weight: bold; color: #007700;}

.block {
  border-left: solid 2px #009900; 
  padding: 0px;
  margin: 0px;
  padding-left: 1ex;
  padding-bottom: 4px;
  margin-left: 4ex;
}

table { border: solid 1px; border-collapse: collapse; margin: auto; }
th,td { border: solid 1px; padding: 5px; }
td.notation { border-left: none; border-right: none;}

</style>

</head><body>


<div id="content">

  <h1>INF304 — TP6</h1>

  <h2>Curiosity Revolutions (1) — Structures de base,
    terrains</h2>

<p>Récupérer les fichiers nécessaires au TP6 : 
</p><pre class="code">cp -r /Public/304_INF_Public/TP6 .
</pre>
<p></p>
  <p>
    Au cours de ce TP et des suivants, vous serez amenés à compléter des
    programmes fournis. Il est important de vous les approprier.
  </p>
  
<h3>Le terrain</h3>

  <p>
    Le robot se déplace dans un terrain rectangulaire composé de
    cases. Ces cases sont soit <em>libres</em>, soit occupées par un
    obstacle.
  </p>
  <p>
    Les terrains seront lus depuis des fichiers textes dont le format
    est le suivant&nbsp;:
</p><ul>
<li>sur la première ligne, un entier <span class="code">L</span> :
  nombre de cases en <em>largeur</em> (ou nombre de colonnes),</li>
<li>sur la deuxième ligne, un entier <span class="code">H</span>:
  nombre de cases en <em>hauteur</em> (ou nombre de lignes),</li>
<li>puis <span class="code">H</span> lignes
  de <span class="code">L</span> caractères qui peuvent être :
  <ul>
    <li>soit <span class="code">'.'</span>  pour représenter une case libre,</li>
    <li>soit <span class="code">'#'</span> pour représenter une case «rocher»,</li>
    <li>soit <span class="code">'~'</span> pour représenter une case «eau»,</li>
    <li>soit <span class="code">'C'</span> pour représenter la
      position initiale du robot.</li>
  </ul>
</li>
</ul>
  <p></p>
  
<p>
  Observez l'exemple de fichier de terrain qui se trouve dans votre
  répertoire.
</p>
<p>
On propose une représentation des terrains par des variables de type
<span class="code">Terrain</span>, défini dans <span class="file">terrain.h</span>&nbsp;:
</p><pre class="code">#ifndef _TERRAIN_H_
#define _TERRAIN_H_

typedef enum { LIBRE, EAU, ROCHER } Case;

#define DIM_MAX 256

// indexation utilisée : 
//  1er  indice : abscisse = colonne (colonne de gauche : abscisse = 0)
//  2ème indice : ordonnée = ligne   (ligne du haut     : ordonnée = 0)

typedef struct {
  int largeur, hauteur;
  Case tab[DIM_MAX][DIM_MAX];
} Terrain;

void lire_terrain(FILE *f, Terrain *t, int *x, int *y);

void afficher_terrain(Terrain *t);

#endif
</pre>
<p></p>

<h5>Exercice 1. </h5>

<ol>
  <li><p>Complétez le corps du paquetage <b><em>terrain</em></b>,
      c'est à dire le fichier <span class="file">terrain.c</span>.</p>

    <p>
      Vous supposerez dans un premier temps que tout se passe
      normalement (le fichier existe, le nombre de cases est bien
      celui spécifié ...).
    </p>
</li><li><p>Utilisez la
  procédure <span class="code">afficher_terrain</span> pour vérifier
  que la lecture s'est bien passée&nbsp;: utilisez le programme de
  test (<span class="file">test_terrain.c</span>) qui lit un terrain
  dans un fichier, puis l'affiche à l'écran.</p>
</li><li><p>Testez les fonctions de lecture et d'affichage de terrains.</p></li>
</ol>


<h4>Gestion des erreurs</h4>

Différents problèmes peuvent se rencontrer lors de la lecture d'un
fichier de terrains&nbsp;:
<ul>
<li>le fichier dont le nom est passé en paramètre ne peut être ouvert
(n'existe pas, n'a pas les permissions requises,...),
</li><li>la largeur ou la hauteur ne sont pas dans l'ensemble de valeurs possibles
d'après la définition du type <span class="code">terrain</span>,
</li><li>la longueur d'une ligne n'est pas égale à la largeur 
(trop courte ou trop longue),
</li><li>le nombre de lignes n'est pas égal à la hauteur 
  (trop petit ou trop grand).
  </li><li>...
</li></ul>

<h5>Exercice 2.</h5>

<p>
En vous inspirant de ce qui a été vu en TD&nbsp;:
</p><ol>
<li>Modifiez votre fonction de lecture d'un terrain pour 
<em>retourner une erreur</em>, parmi une liste de valeurs à déclarer
dans <span class="file">terrain.h</span>.  N'oubliez pas de tester en
créant des fichiers-terrains <i>incorrects</i>.
</li><li>Modifiez le programme <span class="file">test_terrain.c</span> de
façon à ce que, lorsque l'ouverture du fichier se passe mal, c'est à
dire lorsque l'erreur
<span class="code">ERREUR_FICHIER</span> est retournée, 
un nouveau nom de fichier soit demandé à l'utilisateur,
et une nouvelle lecture de terrain tentée avec ce nom de fichier.
</li></ol>
Testez le programme ainsi modifié.
<p></p>

  <p><b>NB :</b> On peut se servir des mécanismes de gestion d'erreurs
    des fonctions
    <span class="code">fopen</span>, <span class="code">fscanf</span>
    et <span class="code">fgets</span> :
    </p><ul>
      <li><b><span class="code">fopen</span></b>
        renvoie <span class="code">NULL</span> en cas d'erreur
      </li><li><b><span class="code">fscanf</span></b> renvoie le nombre de
        valeurs lues, et la valeur <span class="code">EOF</span> si la
        fin du fichier est atteinte avant la première valeur lue
      </li><li><b><span class="code">fgets</span></b> renvoie le pointeur
        vers la chaîne lue en cas de succès, et la
        valeur <span class="code">NULL</span> en cas d'erreur ou si la
        fin du fichier est atteinte avant d'avoir pu lire un
        caractère.
    </li></ul>
  <p></p>


<h3>Le robot</h3>

  <p>
    Le robot est défini par sa position dans le terrain, et son
    orientation&nbsp;:
</p><pre class="code">typedef enum { Nord, Est, Sud, Ouest } Orientation;

typedef struct {
  int x, y;
  Orientation o;
} Robot;
</pre>
On modifie l'état du robot en le faisant <em>avancer</em>, <em>tourner_a_gauche</em>
et <em>tourner_a_droite</em>.<p></p>

  <h5>Exercice 3.</h5>

<p>
</p><ul>
<li>Complétez le corps du paquetage <b>robot</b>.
</li><li>Complétez la procédure de
test <span class="code">test_robot</span> du
fichier <span class="file">test_robot.c</span>&nbsp;: dans le corps de la
boucle, pour :
<ol>
<li>afficher des informations du robot,
</li><li>lire au clavier un caractère (par exemple
parmi <span class="code">'A'</span>,
<span class="code">'G'</span>, <span class="code">'D'</span>
pour <em>avancer</em>, <em>tourner à gauche</em>,
<em>tourner à droite</em>), et selon le caractère, modifier l'état du
robot en conséquence.
</li></ol>
</li></ul>
<p></p>

<h3>Le robot dans le terrain</h3>
<h5>Exercice 4. </h5>

<p>
Lisez le fichier <span class="file">robot_terrain.c</span>. Complétez
la fonction
<span class="code">robot_peut_avancer</span>&nbsp;: le robot peut
avancer si la case devant lui est libre ou s'il est au bord du
terrain.
</p>
<p>
Testez le programme modifié.
</p>

  
<h3>3. Compte-rendu</h3>
<p>
</p><ol>
<li>Créez deux répertoires 
<span class="file">Terrains_Corrects</span> et <span class="file">Terrains_Incorrects</span> 
et placez-y les terrains testés
lors des exercices&nbsp;2 et&nbsp;3.

</li><li>Créez un répertoire nommé <span class="file">TP6</span> contenant
vos fichiers source, le fichier Makefile, ainsi que les deux
  répertoires <span class="file">Terrains_Corrects</span> et <span class="file">Terrains_Incorrects</span> 


</li><li>Compactez le répertoire <span class="file">TP6</span> :
  <pre class="code">    tar czvf TP6.tar.gz TP6
  </pre>
  Déposez le fichier <span class="file">TP6.tar.gz</span>
  sur <a href="http://caseine.org/course/view.php?id=172">la
    page moodle du cours.</a></li>
</ol>
<p></p>

  
</div>

</body></html>